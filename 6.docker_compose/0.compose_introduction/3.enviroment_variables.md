<h1 align="center">
    <span>Environment variables</span>
    <img src="https://cdn.iconscout.com/icon/premium/png-512-thumb/variable-icon-download-in-svg-png-gif-file-formats--mathematical-x-user-interface-pack-icons-2056109.png?f=webp&w=256" alt="octopus icon" width="100px" align="center">
</h1>

As vari√°veis de ambiente s√£o usadas para armazenar informa√ß√µes sens√≠veis, como senhas e configura√ß√µes de banco de dados, sem expor esses dados em arquivos de configura√ß√£o. Isso √© especialmente importante ao compartilhar projetos com outros desenvolvedores, pois garante que as credenciais n√£o sejam inclu√≠das em reposit√≥rios p√∫blicos.

Ao inv√©s de upar no github o arquivo `compose.yml` ou o `aplication.properties` com as senhas expostas, n√≥s podemos trabalhar com variables de ambiente.

Essas variables s√£o criadas no nosso computador local.

<hr>
<br>

## Como visualizar as environment variables?

- `printenv`

- `printenv | grep INSA`

<br>

Existem algumas formas de se trabalhar com environment variables... Entre elas:

<hr>
<br>

## Criando as variables de ambiente direto no terminal

Para criar variables de ambiente no seu computador local, voce precisa abrir o arquivo `~/.zshrc` or `~/.bashrc` e usar o command `export`

1. Crie as varaibles de ambiente:

    ```bash
    # Variables de ambiente no shell do zsh
    export USERNAME_INSANO=bielzin
    export PASSWORD_INSANO=123
    export DB_INSANE=db_tal
    ```

üí° Ap√≥s adicionar as vari√°veis, salve o arquivo e feche o terminal.

<br>

2. Chame essas variables no docker-compose.yml ou no aplication.properties, usando a syntax `${}` :

    ```yaml
    # version: 'versao do docker compose'

    volumes: # Criamos um volume/pasta na nossa m√°quina local
        volume_tal:

    services: # containers que vamos criar
        postgres_container_insano: # esse ser√° nosso container
            container_name: postgres_container_insano
            image: postgres:14.13 # vamos criar o container em cima dessa image
            environment: # variables de ambiente do postgres
                POSTGRES_USER: ${USERNAME_INSANO}
                POSTGRES_PASSWORD: ${PASSWORD_INSANO}
                POSTGRES_DB: ${DB_INSANE}
            ports:
                - 2222:5432 # conexao das portas. A minha porta local 2222 vai se conectar com o porta 5432 do container
            volumes:
                - volume_tal:/var/lib/postgresql/data # copiamos os dados dessa pasta do container para a nossa pasta/volume local "volume_tal"
    ```

‚ö†Ô∏è Importante lembrar:


- Sempre que voc√™ quiser alterar os valores dessas vari√°veis, feche os terminais abertos.

- Antes de alterar as vari√°veis do PostgreSQL, voc√™ deve deletar o volume. Caso contr√°rio, a altera√ß√£o n√£o vai acontecer.

<br>
<br>

üìñ Inclusive, essas varibles podem ser acessadas em outros arquivos, usando a sintaxe `${}`:

```properties
# definimos a porta que vamos usar do tomcat. Geralmente a porta padrao √© 8080.
server.port=8080

# Informamos o caminho do banco de dados. A porta do banco √© a porta 2222 local que conecta com a porta 5432 do container
spring.datasource.url=jdbc:postgresql://localhost:2222/${DB_INSANE}

# Usu√°rio do banco de dados
spring.datasource.username=${USERNAME_INSANO}

# Senha do banco de dados. √â a senha do usuario postgres
spring.datasource.password=${PASSWORD_INSANO}

# Acompanha as altera√ß√µes feitas nas entidades. Qualquer altera√ß√£o feita na entidade, a table tamb√©m vai sofrer altera√ß√£o.
spring.jpa.hibernate.ddl-auto=update

# Mostrar os commands SQL feitos pelo jpa
spring.jpa.show-sql=true

# swagger-ui custom path
springdoc.swagger-ui.path=/swagger.html

# ordenamos os endpoints no swagger
springdoc.swagger-ui.operationsSorter=method
```

<br>
<br>

## Criando um arquivo `.env`

Aqui vamos criar um arquivo `.env` e setar nossas environment variables l√°.

1. Criamos o arquivo .env e setamos as variables:

    ```env
    usuario=batman
    senha=batman
    banco=db_batman
    ```

<br>

2. Chamamos essas variables no docker-compose.yml, usando a syntax `${}` :

    ```yml
    POSTGRES_USER: ${usuario}
    POSTGRES_PASSWORD: ${senha}
    POSTGRES_DB: ${banco}
    ```

‚ö†Ô∏è Sempre que fizer uma altera√ß√£o nas configs do banco, delete o volume e feche o terminal.

üìñ Ao compartilhar esse projeto com algum colega no github, deixamos esse arquivo `.env` no `.gitignore`. Assim, escondemos nossas infos sens√≠veis.

<br>


### Ordem de Busca das Vari√°veis de Ambiente no Docker Compose

1. **Vari√°veis do Sistema**: O Docker Compose primeiro procura as vari√°veis de ambiente definidas no seu sistema (por exemplo, no arquivo ~/.zshrc ou ~/.bashrc).

2. **Arquivo .env**: Se n√£o encontrar as vari√°veis no sistema, ele verifica um arquivo chamado .env no mesmo diret√≥rio do docker-compose.yml. Este arquivo pode conter as defini√ß√µes das vari√°veis que o Docker Compose utilizar√°.